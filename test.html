<html>

<meta charset="utf-8">

<script src="assets/js/carcassonne.js"></script>
<script src="assets/js/test_micro_framework.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<link rel="stylesheet" href="assets/css/test_micro_framework.css">

<body>
    <script>
        it('Implementando la clase Tile con up, down, left y right e imagen', () => {
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            assertEqual(tile.up, ROAD);
            assertEqual(tile.down, ROAD);
            assertEqual(tile.left, CITY);
            assertEqual(tile.right, GRASS);

            assertEqual(tile.image, 'imageUri');
        });

        it('Implementando el metodo rotate(), que rota el Tile a 90 grados a la derecha, de la clase Tile()', () => {
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');

            //         road
            //          ^
            //          |
            // city <- Tile -> grass
            //          |
            //         road

            //         city
            //          ^
            //          |
            // road <- Tile 90 -> road
            //          |
            //         grass

            let rotatedTile = tile.rotate();

            assertEqual(rotatedTile.up, CITY);
            assertEqual(rotatedTile.down, GRASS);
            assertEqual(rotatedTile.left, ROAD);
            assertEqual(rotatedTile.right, ROAD);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');
        });

        it('Implementando el metodo rotate() con degress(grado)', () => {
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');

            //         road
            //          ^
            //          |
            // city <- Tile -> grass
            //          |
            //         road

            //         city
            //          ^
            //          |
            // road <- Tile 90 -> road
            //          |
            //         grass

            let rotatedTile = tile.rotate(degree = 90);

            assertEqual(rotatedTile.up, CITY);
            assertEqual(rotatedTile.down, GRASS);
            assertEqual(rotatedTile.left, ROAD);
            assertEqual(rotatedTile.right, ROAD);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');
            
            //            (road)
            //              ^
            //              |
            // (grass) <- Tile 180 -> (city)
            //              |
            //            (road)

            rotatedTile = tile.rotate(degree = 180);

            assertEqual(rotatedTile.up, ROAD);
            assertEqual(rotatedTile.down, ROAD);
            assertEqual(rotatedTile.left, GRASS);
            assertEqual(rotatedTile.right, CITY);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');

            //            grass
            //             ^
            //             |
            // road <- Tile 270 -> road
            //             |
            //            city

            rotatedTile = tile.rotate(degree = 270);

            assertEqual(rotatedTile.up, GRASS);
            assertEqual(rotatedTile.down, CITY);
            assertEqual(rotatedTile.left, ROAD);
            assertEqual(rotatedTile.right, ROAD);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');

            //           road
            //            ^
            //            |
            // city <- Tile 360 -> grass
            //            |
            //           road

            rotatedTile = tile.rotate(degree = 360);

            assertEqual(rotatedTile.up, ROAD);
            assertEqual(rotatedTile.down, ROAD);
            assertEqual(rotatedTile.left, CITY);
            assertEqual(rotatedTile.right, GRASS);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');
        });

        it('Implementando el metodo rotate(450) de la clase Tile()', () => {
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');

            //         road
            //          ^
            //          |
            // city <- Tile -> grass
            //          |
            //         road



            let rotatedTile = tile.rotate(450);

            assertEqual(rotatedTile.up, CITY);
            assertEqual(rotatedTile.down, GRASS);
            assertEqual(rotatedTile.left, ROAD);
            assertEqual(rotatedTile.right, ROAD);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');
        });

        it('Implementando el metodo rotate(720) de la clase Tile()', () => {
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');

            //         road
            //          ^
            //          |
            // city <- Tile -> grass
            //          |
            //         road

            let rotatedTile = tile.rotate(720);

            assertEqual(rotatedTile.up, ROAD);
            assertEqual(rotatedTile.down, ROAD);
            assertEqual(rotatedTile.left, CITY);
            assertEqual(rotatedTile.right, GRASS);

            // La imagen se tiene que preservar
            assertEqual(rotatedTile.image, 'imageUri');
        });

        // it('Implementando el metodo rotate(-90) de la clase Tile()', () => {
        //     let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');

        //     //         road
        //     //          ^
        //     //          |
        //     // city <- Tile -> grass
        //     //          |
        //     //         road

        //     //          (grass)
        //     //             ^
        //     //             |
        //     // (road) <- Tile -90 -> (road)
        //     //             |
        //     //           (city)

        //     let rotatedTile = tile.rotate(-90);

        //     assertEqual(rotatedTile.up, GRASS);
        //     assertEqual(rotatedTile.down, CITY);
        //     assertEqual(rotatedTile.left, ROAD);
        //     assertEqual(rotatedTile.right, ROAD);

        //     // La imagen se tiene que preservar
        //     assertEqual(rotatedTile.image, 'imageUri');
        // });

        it('Implementando la clase CarcassonneMap()', () => {
            let map = new CarcassonneMap();
        });

        it('Implementando el metodo add() de la clase CarcassonneMap', () => {
            let map = new CarcassonneMap();
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            map.add(tile, 0,0);
        });

        it('Implementando el metodo size() de la clase CarcassonneMap', () => {
            let map = new CarcassonneMap();
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            map.add(tile, 0,0);
            assertEqual(map.size(), 1);
        });

        it('El metodo add() solo debe agregar el tile una sola vez en la posicion x,y', () => {
            let map = new CarcassonneMap();
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            map.add(tile, 0,0);
            map.add(tile, 0,0);
            assertEqual(map.size(), 1);
        });

        it('El metodo add() no debe permitir cambios del Tile en la posicion x,y', () => {
            let map = new CarcassonneMap();
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            let tile2 = new Tile(ROAD, ROAD, ROAD, ROAD, 'imageUri');
            map.add(tile, 0,0);
            map.add(tile2, 0,0);

            let recoveredTile = map.get(0,0)
            // El tile recuperado tiene que ser el tile y no tile2
            assertEqual(recoveredTile.up, ROAD);
            assertEqual(recoveredTile.down, ROAD);
            assertEqual(recoveredTile.left, CITY);
            assertEqual(recoveredTile.right, GRASS);

            assertEqual(map.size(), 1);
        });

        it('Implementado el metodo get(x,y)', () => {
            let map = new CarcassonneMap();
            let tile = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            map.add(tile, 0,0);
            let recoveredTile = map.get(0,0)
            assertEqual(recoveredTile.up, ROAD);
            assertEqual(recoveredTile.down, ROAD);
            assertEqual(recoveredTile.left, CITY);
            assertEqual(recoveredTile.right, GRASS);
        });

        it('Solo se puede agregar tiles que tengan caras con el mismo tipo', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            let tile1 = new Tile(ROAD, ROAD, GRASS, GRASS, 'assets/img/loseta-1.jpeg');
            map.add(tile0, 0,0);
            let isPossible = map.add(tile1, 1,0);

            console.log(tile0);
            console.log(tile1);
            console.log(map.tiles);

            assertEqual(map.size(),2);
            assertEqual(isPossible,true);
        });

        it('No se puede agregar un tile al mapa que no comparta la misma cara', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            let tile1 = new Tile(ROAD, ROAD, GRASS, GRASS, 'assets/img/loseta-1.jpeg');
            map.add(tile0, 0,0);
            let isPossible = map.add(tile1, -1,0);
            
            assertEqual(map.size(),1);
            assertEqual(isPossible,false);
        });

        it('No se puede agregar un tile al mapa en diagonal', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(ROAD, ROAD, CITY, GRASS, 'imageUri');
            let tile1 = new Tile(ROAD, ROAD, GRASS, GRASS, 'assets/img/loseta-1.jpeg');
            map.add(tile0, 0,0);
            let isPossible = map.add(tile1, 1,1);
            
            assertEqual(map.size(),1);
            assertEqual(isPossible,false);
        });

        it('Agregando 2 tiles consecutivos', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            let isPossible = map.add(tile2, 0,1);
            
            assertEqual(map.size(),3);
            assertEqual(isPossible,true);
        });

        it('Agregando 2 tiles consecutivos y el ultimo no se puede agregar', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            let isPossible = map.add(tile2, 1,1);
            
            assertEqual(map.size(),2);
            assertEqual(isPossible,false);
        });

        it('Agregando 3 tiles consecutivos', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');
            let tile3 = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-3.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            let isPossible = map.add(tile3, -1,0);
            
            assertEqual(map.size(),4);
            assertEqual(isPossible,true);
        });

        it('Agregando 3 tiles consecutivos y el ultimo no se puede agregar', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');
            let tile3 = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-3.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            let isPossible = map.add(tile3, 1,1);
            
            assertEqual(map.size(),3);
            assertEqual(isPossible,false);
        });

        it('Agregando 4 tiles consecutivos', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');
            let tile3 = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-3.jpeg');
            let tile4 = new Tile(ROAD, CITY, CITY, ROAD, 'assets/img/loseta-4.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            map.add(tile3, -1,0);
            let isPossible = map.add(tile4, -2,0);
            
            assertEqual(map.size(),5);
            assertEqual(isPossible,true);
        });

        it('Agregando 4 tiles consecutivos y el ultimo no se puede agregar', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');
            let tile3 = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-3.jpeg');
            let tile4 = new Tile(ROAD, CITY, CITY, ROAD, 'assets/img/loseta-4.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            map.add(tile3, -1,0);
            let isPossible = map.add(tile4, 0,2);
            
            assertEqual(map.size(),4);
            assertEqual(isPossible,false);
        });

        it('Agregando 4 tiles consecutivos y el ultimo no se puede agregar', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');
            let tile3 = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-3.jpeg');
            let tile4 = new Tile(ROAD, CITY, CITY, ROAD, 'assets/img/loseta-4.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            map.add(tile3, -1,0);
            
            let isPossible = map.add(tile4, 1,1);
            
            assertEqual(map.size(),4);
            assertEqual(isPossible,false);
        });

        it('Obteniendo la frontera del tile inicial', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');

            map.add(tile0, 0,0);
            let frontier = map.getFrontier();

            assertEqual(map.size(), 1);
            assertEqual(frontier.size, 4)
        });

        it('Obteniendo la x, y a partir de la llave', () => {
            let map = new CarcassonneMap();
            let position = map._getXYFromString('(1, 1)');
            
            assertEqual(position[0], 1);
            assertEqual(position[1], 1);

            position = map._getXYFromString('(-1, -10)');
            
            assertEqual(position[0], -1);
            assertEqual(position[1], -10);

            position = map._getXYFromString('(-5,-1)');
            
            assertEqual(position[0], -5);
            assertEqual(position[1], -1);
        });

        it('Obteniendo la frontera con 2 tiles', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            let frontier = map.getFrontier();

            assertEqual(map.size(), 2);
            assertEqual(frontier.size, 6)
        });

        it('Obteniendo la frontera con 3 tiles', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(GRASS, GRASS, ROAD, ROAD, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-2.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, 0,1);
            let frontier = map.getFrontier();
            console.log("Frontier",frontier);
            assertEqual(map.size(), 3);
            assertEqual(frontier.size, 7)
        });

        it('Obteniendo frontera valida', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tileIWantToPlace = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-1.jpeg');

            map.add(tile0, 0,0);

            let frontier = map.getValidFrontier(tileIWantToPlace);
            console.log("Frontier",frontier);
            assertEqual(frontier.length, 2)
        });

        it('Obteniendo frontera valida para 4 tiles en el mapa', () => {
            let map = new CarcassonneMap();
            let tile0 = new Tile(CITY, GRASS, ROAD, ROAD, 'imageUri');
            let tile1 = new Tile(ROAD, CITY, ROAD, CITY, 'assets/img/loseta-1.jpeg');
            let tile2 = new Tile(ROAD, CITY, CITY, ROAD, 'assets/img/loseta-2.jpeg');
            
            let tileIWantToPlace = new Tile(GRASS, ROAD, ROAD, ROAD, 'assets/img/loseta-1.jpeg');

            map.add(tile0, 0,0);
            map.add(tile1, 1,0);
            map.add(tile2, -1,0);

            // 0, -1
            // -1, 1
            // 1, 1

            let frontier = map.getValidFrontier(tileIWantToPlace);
            console.log("Frontier",frontier);
            assertEqual(frontier.length, 3)
        });
    </script>
</body>

</html>